# 开发指南 (Developer Guide)

## 1. 技术栈与环境

- **语言标准**: C++20
  - **GCC**: 10.0+ (推荐 11.2+)
  - **Clang**: 12.0+ (推荐 14.0+)
  - **MSVC**: VS2019 16.11+
- **构建系统**: CMake 3.20+
- **包管理**: vcpkg (推荐) 或 Conan
- **核心依赖**:
  - `boost`: Asio (网络), Beast (WebSocket), CircularBuffer
  - `fmt`: 格式化日志
  - `nlohmann/json`: JSON 序列化
  - `spdlog`: 高性能日志
  - `openssl`: 加密签名
  - `prometheus-cpp`: 指标暴露

## 2. 环境搭建 (MacOS/Linux)

```bash
# 1. 安装 vcpkg
git clone https://github.com/microsoft/vcpkg
./vcpkg/bootstrap-vcpkg.sh

# 2. 安装依赖
./vcpkg/vcpkg install boost fmt nlohmann-json spdlog openssl prometheus-cpp

# 3. 克隆项目
git clone https://github.com/your-repo/ai-trade.git
cd ai-trade
```

## 3. 构建与编译

```bash
mkdir build && cd build

# 配置 CMake (假设 vcpkg 在上级目录)
cmake .. -DCMAKE_TOOLCHAIN_FILE=../vcpkg/scripts/buildsystems/vcpkg.cmake

# 编译
cmake --build . -j 8
```

## 4. 运行模式

系统支持三种运行模式，通过命令行参数或配置文件控制：

### 4.1 回放模式 (Replay)
用于策略回归和逻辑验证。
```bash
./bin/trade_bot --mode=replay --data=./data/2023_btc_1m.csv --config=./config/replay.yaml
```

### 4.2 模拟盘模式 (Paper Trading / Simulation)
连接交易所测试网 (Testnet) 或本地模拟撮合器。
```bash
./bin/trade_bot --mode=paper --config=./config/paper.yaml
```

### 4.3 实盘模式 (Live)
**警告**: 必须通过 Gate 验证后方可运行。
```bash
./bin/trade_bot --mode=live --config=./config/live.yaml
```

## 5. 模拟交易所 (Exchange Simulator)

为了验证 OMS 和执行逻辑（特别是限频、拒单、部分成交），我们提供了一个简单的 Python 模拟器。

```bash
# 启动模拟交易所
cd tools/exchange_sim
pip install -r requirements.txt
python main.py --port 8080
```

然后在 `config.yaml` 中将 `exchange.base_url` 指向 `http://localhost:8080`。

## 6. 代码规范

- **命名**: Google C++ Style Guide
- **格式化**: 提交前请运行 `clang-format`
- **测试**: 单元测试使用 GTest
  ```bash
  cd build
  ctest
  ```