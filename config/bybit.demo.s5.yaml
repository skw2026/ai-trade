system:
  id: "bot-bybit-demo-s5"
  mode: "paper"
  primary_symbol: "BTCUSDT"
  data_path: "./data/demo_s5"
  max_ticks: 0
  status_log_interval_ticks: 20
  remote_risk_refresh_interval_ticks: 10
  reconcile:
    enabled: true
    interval_ticks: 10
    tolerance_notional_usd: 8.0
    mismatch_confirmations: 4
    pending_order_stale_ms: 15000

exchange:
  platform: "bybit"
  bybit:
    testnet: false
    demo_trading: true
    category: "linear"
    account_type: "UNIFIED"
    expected_account_mode: "UNIFIED"
    expected_margin_mode: "ISOLATED"
    expected_position_mode: "ONE_WAY"
    public_ws_enabled: true
    public_ws_rest_fallback: true
    private_ws_enabled: true
    private_ws_rest_fallback: true
    ws_reconnect_interval_ms: 15000
    execution_poll_limit: 50

risk:
  max_abs_notional_usd: 1800
  max_drawdown:
    degraded_threshold: 0.08
    cooldown_threshold: 0.12
    fuse_threshold: 0.20

execution:
  max_order_notional: 450
  min_rebalance_notional_usd: 80
  min_order_interval_ms: 3000
  reverse_signal_cooldown_ticks: 10
  enable_fee_aware_entry_gate: true
  entry_fee_bps: 5.5
  exit_fee_bps: 5.5
  expected_slippage_bps: 1.0
  min_expected_edge_bps: 1.0
  # 允许在高费率估计场景下放宽入场边际门槛上限，避免长期“全被成本门挡住”。
  # 加速阶段：降低上限，先恢复成交样本，再用报告回调。
  required_edge_cap_bps: 5.2
  adaptive_fee_gate_enabled: true
  adaptive_fee_gate_min_samples: 80
  adaptive_fee_gate_trigger_ratio: 0.70
  adaptive_fee_gate_max_relax_bps: 2.0
  maker_entry_enabled: true
  maker_fallback_to_market: true
  maker_price_offset_bps: 1.0
  maker_post_only: true
  maker_edge_relax_bps: 1.0
  cost_filter_cooldown_trigger_count: 8
  cost_filter_cooldown_ticks: 120
  protection:
    enabled: false
    require_sl: true
    enable_tp: true
    attach_timeout_ms: 1500
    stop_loss_ratio: 0.01
    take_profit_ratio: 0.015

strategy:
  signal_notional_usd: 450
  signal_deadband_abs: 0.6
  min_hold_ticks: 4
  defensive_notional_ratio: 0.55
  defensive_entry_score: 1.0
  defensive_trend_scale: 0.25
  defensive_range_scale: 1.00
  defensive_extreme_scale: 0.45

integrator:
  enabled: true
  model_type: "catboost"
  shadow:
    enabled: true
    log_model_score: true
    model_report_path: "./data/research/integrator_report.json"
    score_gain: 1.0

self_evolution:
  enabled: true
  # S5 优化：缩短评估窗口，提升可观测动作频率。
  update_interval_ticks: 600
  min_update_interval_ticks: 600
  # 允许小盈亏窗口也参与学习，减少长期 skipped。
  min_abs_window_pnl_usd: 0.5
  min_bucket_ticks_for_update: 60
  # 以虚拟PnL学习，避免“零成交=零学习”死锁。
  use_virtual_pnl: true
  use_counterfactual_search: true
  counterfactual_min_improvement_usd: 0.25
  counterfactual_improvement_decay_per_filtered_signal_usd: 0.02
  virtual_cost_bps: 6.5
  # 信号层：基于在线因子IC做权重自适应（与反事实搜索互补观测）。
  enable_factor_ic_adaptive_weights: true
  factor_ic_min_samples: 120
  factor_ic_min_abs: 0.01
  # 元控制层：仅在可学习窗口（|t-stat| 足够）允许更新。
  enable_learnability_gate: true
  learnability_min_samples: 120
  learnability_min_t_stat_abs: 1.0
  max_single_strategy_weight: 0.55
  max_weight_step: 0.01
  rollback_degrade_windows: 3
  rollback_degrade_threshold_score: -15.0
  rollback_cooldown_ticks: 3600
  initial_trend_weight: 0.50
  initial_defensive_weight: 0.50

gate:
  # S5 稳态 soak：更关注“策略持续运行”而不是强交易频次。
  min_effective_signals_per_day: 2
  min_fills_per_day: 0
  heartbeat_empty_signal_ticks: 36
  window_ticks: 288
  enforce_runtime_actions: false
  fail_to_reduce_only_windows: 2
  fail_to_halt_windows: 4
  reduce_only_cooldown_ticks: 120
  halt_cooldown_ticks: 240
  pass_to_resume_windows: 2

universe:
  enabled: true
  update_interval_ticks: 20
  max_active_symbols: 2
  min_active_symbols: 1
  fallback_symbols: ["BTCUSDT", "ETHUSDT"]
  candidate_symbols: ["BTCUSDT", "ETHUSDT", "SOLUSDT"]
